<% content_for :content_search do %>
  <div>
    <%= form_tag "/project/project_search", :method=>"post" do %>
      <p>
        <%= label_tag :number, "时间：" , :class=>"loginlabel"%>
        <%= select_tag(:work_y, options_for_select(@work_year), :style=>"width:140px;height:25px;margin-top:5px;", :onchange=>"change_identifer()" )%>
        <%= label_tag  :password ,"编号：" , :class=>"loginlabel" %>
        <%= select_tag(:identifer, options_for_select(""), :style=>"width:140px;height:25px;margin-top:5px;") %>
        <%= hidden_field_tag 'group_name', @group_id %>
        <%= submit_tag "查询" , :disable_with => "请等待……" , :style=>"background-color:#f5f5f5;width:60px;margin-left:100px;",:class=>"button btn" %>
      </p>
    <% end %>
  </div>
<% end %>

<% content_for :content_right do %>
<div>
<!--   <h3>所有的工程</h3> -->
    <table class="table">
      <% @project.each do |project| %>
        <tr>
          <td><%= project.project_name %></td>
          <td><%= link_to 'Show', "/project/show/#{project.id}" %></td>
          <td><%= link_to 'Update', "#", :class=>"update_project", :data=>project.id %></td>
          <td><%= link_to 'Destroy', "/project/destroy/#{project.id}", :onclick => "return confirm('Are you sure?')" %></td>
        </tr>     
      <% end %>
    </table>

</div>
  <div style="border:1px solid #CCC;width:370px;height:250px;position:absolute;top:200px;left:200px;display:none;background-color:white;" id="pro_edit">
    <div class="pro_edit_top" style="width:100%;height:15%;background-color:green;margin-bottom:15px;"></div>
    <form method="post" id="pro_edit_form" class="form-horizontal" role="form">
      <div class="form-group">
        <label for="inputstatus" class="col-sm-3 control-label">项目名：</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" id="project_name" name="project_name" placeholder="" style="width:80%;">
        </div>
      </div>
      <div class="form-group">
        <label for="inputstatus" class="col-sm-3 control-label">描&nbsp;&nbsp;&nbsp;述：</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" id="description" name="description" placeholder="" style="width:80%;">
        </div>
      </div>
      <button type="submit" class="btn btn-primary" style="margin-left:60px;margin-top:10px;">Submit</button>
      <button type="reset" class="btn btn-primary" style="margin-left:20px;margin-top:10px;">Reset</button>
      <button type="reset" class="btn btn-primary" style="margin-left:20px;margin-top:10px;" onclick="cancel_edit();">Cancel</button>
    </form>
  </div>
<script>
  $("document").ready(function(){
    $(".update_project").click(function(){
      $("#pro_edit").css("display","block");
      var key = $(this).attr("data");
      var action_url = "/project/"+key+"/edit_project";
      $("#pro_edit_form").attr("action", action_url);
      var get_info_url = "/project/"+key+"/get_info";
      $.get(get_info_url,function(data){
        console.log(data)
        $("#project_name").val(data.project_name);
        $("#description").val(data.description);

      });
    });
  });
  function cancel_edit(){
    $("#pro_edit").css("display","none");
  }

  function change_identifer(){
    var key = $("#work_y").val()
    var get_identifer_url = "/project/"+key+"/get_identifer"; 
    $.get(get_identifer_url, function(data){
      console.log(data);
      var ident_item = document.getElementById("identifer");
      //清除原有的option选项
      for(i=ident_item.options.length-1;i>=0;i--){
          ident_item.options[i] = null
        }
        for(var key in data){
        //根据年份添加相应的版本编号      
        var ident_option = document.createElement("option");
        ident_option.innerHTML = data[key];
        ident_option.setAttribute("class","option_identifer");
        ident_item.appendChild(ident_option);
      }
    
  });

  
}
</script>

<% end %>